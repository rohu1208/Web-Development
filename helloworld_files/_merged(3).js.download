/*! For license information please see _merged.js.LICENSE.txt */
(function(){var n=this,t=n._,e={},r=Array.prototype,i=Object.prototype,a=Function.prototype,u=r.push,o=r.slice,l=r.concat,c=i.toString,f=i.hasOwnProperty,s=r.forEach,p=r.map,d=r.reduce,h=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,x=Array.isArray,w=Object.keys,j=a.bind,I=function(n){return n instanceof I?n:this instanceof I?void(this._wrapped=n):new I(n)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=I),exports._=I):n._=I,I.VERSION="1.4.4";var _=I.each=I.forEach=function(n,t,r){if(null!=n)if(s&&n.forEach===s)n.forEach(t,r);else if(n.length===+n.length){for(var i=0,a=n.length;a>i;i++)if(t.call(r,n[i],i,n)===e)return}else for(var u in n)if(I.has(n,u)&&t.call(r,n[u],u,n)===e)return};I.map=I.collect=function(n,t,e){var r=[];return null==n?r:p&&n.map===p?n.map(t,e):(_(n,(function(n,i,a){r[r.length]=t.call(e,n,i,a)})),r)};var A="Reduce of empty array with no initial value";I.reduce=I.foldl=I.inject=function(n,t,e,r){var i=arguments.length>2;if(null==n&&(n=[]),d&&n.reduce===d)return r&&(t=I.bind(t,r)),i?n.reduce(t,e):n.reduce(t);if(_(n,(function(n,a,u){i?e=t.call(r,e,n,a,u):(e=n,i=!0)})),!i)throw new TypeError(A);return e},I.reduceRight=I.foldr=function(n,t,e,r){var i=arguments.length>2;if(null==n&&(n=[]),h&&n.reduceRight===h)return r&&(t=I.bind(t,r)),i?n.reduceRight(t,e):n.reduceRight(t);var a=n.length;if(a!==+a){var u=I.keys(n);a=u.length}if(_(n,(function(o,l,c){l=u?u[--a]:--a,i?e=t.call(r,e,n[l],l,c):(e=n[l],i=!0)})),!i)throw new TypeError(A);return e},I.find=I.detect=function(n,t,e){var r;return E(n,(function(n,i,a){return t.call(e,n,i,a)?(r=n,!0):void 0})),r},I.filter=I.select=function(n,t,e){var r=[];return null==n?r:v&&n.filter===v?n.filter(t,e):(_(n,(function(n,i,a){t.call(e,n,i,a)&&(r[r.length]=n)})),r)},I.reject=function(n,t,e){return I.filter(n,(function(n,r,i){return!t.call(e,n,r,i)}),e)},I.every=I.all=function(n,t,r){t||(t=I.identity);var i=!0;return null==n?i:m&&n.every===m?n.every(t,r):(_(n,(function(n,a,u){return(i=i&&t.call(r,n,a,u))?void 0:e})),!!i)};var E=I.some=I.any=function(n,t,r){t||(t=I.identity);var i=!1;return null==n?i:g&&n.some===g?n.some(t,r):(_(n,(function(n,a,u){return i||(i=t.call(r,n,a,u))?e:void 0})),!!i)};I.contains=I.include=function(n,t){return null!=n&&(y&&n.indexOf===y?-1!=n.indexOf(t):E(n,(function(n){return n===t})))},I.invoke=function(n,t){var e=o.call(arguments,2),r=I.isFunction(t);return I.map(n,(function(n){return(r?t:n[t]).apply(n,e)}))},I.pluck=function(n,t){return I.map(n,(function(n){return n[t]}))},I.where=function(n,t,e){return I.isEmpty(t)?e?null:[]:I[e?"find":"filter"](n,(function(n){for(var e in t)if(t[e]!==n[e])return!1;return!0}))},I.findWhere=function(n,t){return I.where(n,t,!0)},I.max=function(n,t,e){if(!t&&I.isArray(n)&&n[0]===+n[0]&&65535>n.length)return Math.max.apply(Math,n);if(!t&&I.isEmpty(n))return-1/0;var r={computed:-1/0,value:-1/0};return _(n,(function(n,i,a){var u=t?t.call(e,n,i,a):n;u>=r.computed&&(r={value:n,computed:u})})),r.value},I.min=function(n,t,e){if(!t&&I.isArray(n)&&n[0]===+n[0]&&65535>n.length)return Math.min.apply(Math,n);if(!t&&I.isEmpty(n))return 1/0;var r={computed:1/0,value:1/0};return _(n,(function(n,i,a){var u=t?t.call(e,n,i,a):n;r.computed>u&&(r={value:n,computed:u})})),r.value},I.shuffle=function(n){var t,e=0,r=[];return _(n,(function(n){t=I.random(e++),r[e-1]=r[t],r[t]=n})),r};var T=function(n){return I.isFunction(n)?n:function(t){return t[n]}};I.sortBy=function(n,t,e){var r=T(t);return I.pluck(I.map(n,(function(n,t,i){return{value:n,index:t,criteria:r.call(e,n,t,i)}})).sort((function(n,t){var e=n.criteria,r=t.criteria;if(e!==r){if(e>r||void 0===e)return 1;if(r>e||void 0===r)return-1}return n.index<t.index?-1:1})),"value")};var k=function(n,t,e,r){var i={},a=T(t||I.identity);return _(n,(function(t,u){var o=a.call(e,t,u,n);r(i,o,t)})),i};I.groupBy=function(n,t,e){return k(n,t,e,(function(n,t,e){(I.has(n,t)?n[t]:n[t]=[]).push(e)}))},I.countBy=function(n,t,e){return k(n,t,e,(function(n,t){I.has(n,t)||(n[t]=0),n[t]++}))},I.sortedIndex=function(n,t,e,r){for(var i=(e=null==e?I.identity:T(e)).call(r,t),a=0,u=n.length;u>a;){var o=a+u>>>1;i>e.call(r,n[o])?a=o+1:u=o}return a},I.toArray=function(n){return n?I.isArray(n)?o.call(n):n.length===+n.length?I.map(n,I.identity):I.values(n):[]},I.size=function(n){return null==n?0:n.length===+n.length?n.length:I.keys(n).length},I.first=I.head=I.take=function(n,t,e){return null==n?void 0:null==t||e?n[0]:o.call(n,0,t)},I.initial=function(n,t,e){return o.call(n,0,n.length-(null==t||e?1:t))},I.last=function(n,t,e){return null==n?void 0:null==t||e?n[n.length-1]:o.call(n,Math.max(n.length-t,0))},I.rest=I.tail=I.drop=function(n,t,e){return o.call(n,null==t||e?1:t)},I.compact=function(n){return I.filter(n,I.identity)};var S=function(n,t,e){return _(n,(function(n){I.isArray(n)?t?u.apply(e,n):S(n,t,e):e.push(n)})),e};I.flatten=function(n,t){return S(n,t,[])},I.without=function(n){return I.difference(n,o.call(arguments,1))},I.uniq=I.unique=function(n,t,e,r){I.isFunction(t)&&(r=e,e=t,t=!1);var i=e?I.map(n,e,r):n,a=[],u=[];return _(i,(function(e,r){(t?r&&u[u.length-1]===e:I.contains(u,e))||(u.push(e),a.push(n[r]))})),a},I.union=function(){return I.uniq(l.apply(r,arguments))},I.intersection=function(n){var t=o.call(arguments,1);return I.filter(I.uniq(n),(function(n){return I.every(t,(function(t){return I.indexOf(t,n)>=0}))}))},I.difference=function(n){var t=l.apply(r,o.call(arguments,1));return I.filter(n,(function(n){return!I.contains(t,n)}))},I.zip=function(){for(var n=o.call(arguments),t=I.max(I.pluck(n,"length")),e=Array(t),r=0;t>r;r++)e[r]=I.pluck(n,""+r);return e},I.object=function(n,t){if(null==n)return{};for(var e={},r=0,i=n.length;i>r;r++)t?e[n[r]]=t[r]:e[n[r][0]]=n[r][1];return e},I.indexOf=function(n,t,e){if(null==n)return-1;var r=0,i=n.length;if(e){if("number"!=typeof e)return n[r=I.sortedIndex(n,t)]===t?r:-1;r=0>e?Math.max(0,i+e):e}if(y&&n.indexOf===y)return n.indexOf(t,e);for(;i>r;r++)if(n[r]===t)return r;return-1},I.lastIndexOf=function(n,t,e){if(null==n)return-1;var r=null!=e;if(b&&n.lastIndexOf===b)return r?n.lastIndexOf(t,e):n.lastIndexOf(t);for(var i=r?e:n.length;i--;)if(n[i]===t)return i;return-1},I.range=function(n,t,e){1>=arguments.length&&(t=n||0,n=0),e=arguments[2]||1;for(var r=Math.max(Math.ceil((t-n)/e),0),i=0,a=Array(r);r>i;)a[i++]=n,n+=e;return a},I.bind=function(n,t){if(n.bind===j&&j)return j.apply(n,o.call(arguments,1));var e=o.call(arguments,2);return function(){return n.apply(t,e.concat(o.call(arguments)))}},I.partial=function(n){var t=o.call(arguments,1);return function(){return n.apply(this,t.concat(o.call(arguments)))}},I.bindAll=function(n){var t=o.call(arguments,1);return 0===t.length&&(t=I.functions(n)),_(t,(function(t){n[t]=I.bind(n[t],n)})),n},I.memoize=function(n,t){var e={};return t||(t=I.identity),function(){var r=t.apply(this,arguments);return I.has(e,r)?e[r]:e[r]=n.apply(this,arguments)}},I.delay=function(n,t){var e=o.call(arguments,2);return setTimeout((function(){return n.apply(null,e)}),t)},I.defer=function(n){return I.delay.apply(I,[n,1].concat(o.call(arguments,1)))},I.throttle=function(n,t){var e,r,i,a,u=0,o=function(){u=new Date,i=null,a=n.apply(e,r)};return function(){var l=new Date,c=t-(l-u);return e=this,r=arguments,0>=c?(clearTimeout(i),i=null,u=l,a=n.apply(e,r)):i||(i=setTimeout(o,c)),a}},I.debounce=function(n,t,e){var r,i;return function(){var a=this,u=arguments,o=function(){r=null,e||(i=n.apply(a,u))},l=e&&!r;return clearTimeout(r),r=setTimeout(o,t),l&&(i=n.apply(a,u)),i}},I.once=function(n){var t,e=!1;return function(){return e||(e=!0,t=n.apply(this,arguments),n=null),t}},I.wrap=function(n,t){return function(){var e=[n];return u.apply(e,arguments),t.apply(this,e)}},I.compose=function(){var n=arguments;return function(){for(var t=arguments,e=n.length-1;e>=0;e--)t=[n[e].apply(this,t)];return t[0]}},I.after=function(n,t){return 0>=n?t():function(){return 1>--n?t.apply(this,arguments):void 0}},I.keys=w||function(n){if(n!==Object(n))throw new TypeError("Invalid object");var t=[];for(var e in n)I.has(n,e)&&(t[t.length]=e);return t},I.values=function(n){var t=[];for(var e in n)I.has(n,e)&&t.push(n[e]);return t},I.pairs=function(n){var t=[];for(var e in n)I.has(n,e)&&t.push([e,n[e]]);return t},I.invert=function(n){var t={};for(var e in n)I.has(n,e)&&(t[n[e]]=e);return t},I.functions=I.methods=function(n){var t=[];for(var e in n)I.isFunction(n[e])&&t.push(e);return t.sort()},I.extend=function(n){return _(o.call(arguments,1),(function(t){if(t)for(var e in t)n[e]=t[e]})),n},I.pick=function(n){var t={},e=l.apply(r,o.call(arguments,1));return _(e,(function(e){e in n&&(t[e]=n[e])})),t},I.omit=function(n){var t={},e=l.apply(r,o.call(arguments,1));for(var i in n)I.contains(e,i)||(t[i]=n[i]);return t},I.defaults=function(n){return _(o.call(arguments,1),(function(t){if(t)for(var e in t)null==n[e]&&(n[e]=t[e])})),n},I.clone=function(n){return I.isObject(n)?I.isArray(n)?n.slice():I.extend({},n):n},I.tap=function(n,t){return t(n),n};var C=function(n,t,e,r){if(n===t)return 0!==n||1/n==1/t;if(null==n||null==t)return n===t;n instanceof I&&(n=n._wrapped),t instanceof I&&(t=t._wrapped);var i=c.call(n);if(i!=c.call(t))return!1;switch(i){case"[object String]":return n==t+"";case"[object Number]":return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case"[object Date]":case"[object Boolean]":return+n==+t;case"[object RegExp]":return n.source==t.source&&n.global==t.global&&n.multiline==t.multiline&&n.ignoreCase==t.ignoreCase}if("object"!=typeof n||"object"!=typeof t)return!1;for(var a=e.length;a--;)if(e[a]==n)return r[a]==t;e.push(n),r.push(t);var u=0,o=!0;if("[object Array]"==i){if(o=(u=n.length)==t.length)for(;u--&&(o=C(n[u],t[u],e,r)););}else{var l=n.constructor,f=t.constructor;if(l!==f&&!(I.isFunction(l)&&l instanceof l&&I.isFunction(f)&&f instanceof f))return!1;for(var s in n)if(I.has(n,s)&&(u++,!(o=I.has(t,s)&&C(n[s],t[s],e,r))))break;if(o){for(s in t)if(I.has(t,s)&&!u--)break;o=!u}}return e.pop(),r.pop(),o};I.isEqual=function(n,t){return C(n,t,[],[])},I.isEmpty=function(n){if(null==n)return!0;if(I.isArray(n)||I.isString(n))return 0===n.length;for(var t in n)if(I.has(n,t))return!1;return!0},I.isElement=function(n){return!(!n||1!==n.nodeType)},I.isArray=x||function(n){return"[object Array]"==c.call(n)},I.isObject=function(n){return n===Object(n)},_(["Arguments","Function","String","Number","Date","RegExp"],(function(n){I["is"+n]=function(t){return c.call(t)=="[object "+n+"]"}})),I.isArguments(arguments)||(I.isArguments=function(n){return!(!n||!I.has(n,"callee"))}),"function"!=typeof/./&&(I.isFunction=function(n){return"function"==typeof n}),I.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},I.isNaN=function(n){return I.isNumber(n)&&n!=+n},I.isBoolean=function(n){return!0===n||!1===n||"[object Boolean]"==c.call(n)},I.isNull=function(n){return null===n},I.isUndefined=function(n){return void 0===n},I.has=function(n,t){return f.call(n,t)},I.noConflict=function(){return n._=t,this},I.identity=function(n){return n},I.times=function(n,t,e){for(var r=Array(n),i=0;n>i;i++)r[i]=t.call(e,i);return r},I.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))};var O={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};O.unescape=I.invert(O.escape);var M={escape:RegExp("["+I.keys(O.escape).join("")+"]","g"),unescape:RegExp("("+I.keys(O.unescape).join("|")+")","g")};I.each(["escape","unescape"],(function(n){I[n]=function(t){return null==t?"":(""+t).replace(M[n],(function(t){return O[n][t]}))}})),I.result=function(n,t){if(null==n)return null;var e=n[t];return I.isFunction(e)?e.call(n):e},I.mixin=function(n){_(I.functions(n),(function(t){var e=I[t]=n[t];I.prototype[t]=function(){var n=[this._wrapped];return u.apply(n,arguments),q.call(this,e.apply(I,n))}}))};var R=0;I.uniqueId=function(n){var t=++R+"";return n?n+t:t},I.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var F=/(.)^/,N={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;I.template=function(n,t,e){var r;e=I.defaults({},e,I.templateSettings);var i=RegExp([(e.escape||F).source,(e.interpolate||F).source,(e.evaluate||F).source].join("|")+"|$","g"),a=0,u="__p+='";n.replace(i,(function(t,e,r,i,o){return u+=n.slice(a,o).replace(L,(function(n){return"\\"+N[n]})),e&&(u+="'+\n((__t=("+e+"))==null?'':_.escape(__t))+\n'"),r&&(u+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(u+="';\n"+i+"\n__p+='"),a=o+t.length,t})),u+="';\n",e.variable||(u="with(obj||{}){\n"+u+"}\n"),u="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+u+"return __p;\n";try{r=Function(e.variable||"obj","_",u)}catch(n){throw n.source=u,n}if(t)return r(t,I);var o=function(n){return r.call(this,n,I)};return o.source="function("+(e.variable||"obj")+"){\n"+u+"}",o},I.chain=function(n){return I(n).chain()};var q=function(n){return this._chain?I(n).chain():n};I.mixin(I),_(["pop","push","reverse","shift","sort","splice","unshift"],(function(n){var t=r[n];I.prototype[n]=function(){var e=this._wrapped;return t.apply(e,arguments),"shift"!=n&&"splice"!=n||0!==e.length||delete e[0],q.call(this,e)}})),_(["concat","join","slice"],(function(n){var t=r[n];I.prototype[n]=function(){return q.call(this,t.apply(this._wrapped,arguments))}})),I.extend(I.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this),function(n){jQuery.fn.extend({elastic:function(){var t=["paddingTop","paddingRight","paddingBottom","paddingLeft","fontSize","lineHeight","fontFamily","width","fontWeight","border-top-width","border-right-width","border-bottom-width","border-left-width","borderTopStyle","borderTopColor","borderRightStyle","borderRightColor","borderBottomStyle","borderBottomColor","borderLeftStyle","borderLeftColor"];return this.each((function(){if("textarea"!==this.type)return!1;var e=jQuery(this),r=jQuery('<div class="weglot-exclude" />').css({position:"absolute",display:"none","word-wrap":"break-word","white-space":"pre-wrap"}),i=parseInt(e.css("line-height"),10)||parseInt(e.css("font-size"),"10"),a=parseInt(e.css("height"),10)||3*i,u=parseInt(e.css("max-height"),10)||Number.MAX_VALUE;u<0&&(u=Number.MAX_VALUE),r.appendTo(e.parent());for(var o=t.length;o--;)r.css(t[o].toString(),e.css(t[o].toString()));function l(){var n=Math.floor(parseInt(e.width(),10));r.width()!==n&&(r.css({width:n+"px"}),f(!0))}function c(n,t){var r=Math.floor(parseInt(n,10));e.height()!==r&&e.css({height:r+"px",overflow:t})}function f(n){var t=e.val().replace(/&/g,"&amp;").replace(/ {2}/g,"&nbsp;").replace(/<|>/g,"&gt;").replace(/\n/g,"<br />"),o=r.html().replace(/<br>/gi,"<br />");if((n||t+"&nbsp;"!==o)&&(r.html(t+"&nbsp;"),Math.abs(r.height()+i-e.height())>3)){var l=r.height()>i+3?r.height()+i:r.height();l>=u?c(u,"auto"):c(l<=a?a:l,"hidden")}}e.css({overflow:"hidden"}),e.bind("keyup change cut paste",(function(){f()})),n(window).bind("resize",l),e.bind("resize",l),e.bind("update",f),e.bind("input paste",(function(n){setTimeout(f,250)})),f()}))}})}(jQuery),function(n){n.event.special.input={setup:function(t,e){var r,i=this,a=i.value,u=document.createElement(this.tagName),o="oninput"in u||function(n){if(n.setAttribute("oninput","return"),"function"==typeof n.oninput)return!0;try{document.createEvent("KeyboardEvent");var t=!1,e=function(n){t=!0,n.preventDefault(),n.stopPropagation()};return document.body.appendChild(n),n.addEventListener("input",e,!1),n.removeEventListener("input",e,!1),document.body.removeChild(n),t}catch(n){}}(u),l="inputEventNS"+~~(1e7*Math.random()),c=["focus","blur","paste","cut","keydown","drop",""].join("."+l+" ");function f(){var t=n(i);i.value==a||t.data("triggering.inputEvent")||(a=i.value,t.data("triggering.inputEvent",!0).trigger("input"),window.setTimeout((function(){t.data("triggering.inputEvent",!1)}),0))}if(o)return!1;n(this).find("input, textarea").andSelf().filter("input, textarea").bind(c,(function(n){"focus"==n.type?(f(),clearInterval(r),r=window.setInterval(f,250)):"blur"==n.type?window.clearInterval(r):window.setTimeout(f,0)})),n(this).data("inputEventHandlerNS",l)},teardown:function(){var t=n(this);t.find("input, textarea").unbind(t.data("inputEventHandlerNS")),t.data("inputEventHandlerNS","")}},n.fn.input=function(n){return n?this.bind("input",n):this.trigger("input")}}(jQuery),function(n,t,e){var r=8,i=9,a=13,u=37,o=38,l=39,c=40,f=36,s=35,p={triggerChar:"@",onDataRequest:n.noop,minChars:2,showAvatars:!0,elastic:!0,classes:{autoCompleteItemActive:"active"},templates:{wrapper:t.template('<div class="mentions-input-box"></div>'),autocompleteList:t.template('<div class="mentions-autocomplete-list"></div>'),autocompleteListItem:t.template('<li data-ref-id="<%= id %>" data-ref-type="<%= type %>" data-display="<%= display %>"><%= content %></li>'),autocompleteListItemAvatar:t.template('<img src="<%= avatar %>" />'),autocompleteListItemIcon:t.template('<div class="icon <%= icon %>"></div>'),mentionsOverlay:t.template('<div class="mentions"><div></div></div>'),mentionItemSyntax:t.template("@[<%= value %>](<%= type %>:<%= id %>)"),mentionItemHighlight:t.template("<strong><span><%= value %></span></strong>")}},d=function(n){return t.escape(n)},h=function(n,t){return t||t.length?n.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>"):n},v=function(n,t){if(n.createTextRange){var e=n.createTextRange();e.move("character",t),e.select()}else n.selectionStart?(n.focus(),n.setSelectionRange(t,t)):n.focus()},m=function(n){return n.replace(/\s+$/,"")},g=function(e){var g,y,b,x,w,j,I,_=[],A={},E=[];function T(){var n=C();t.each(_,(function(t){var r=e.templates.mentionItemSyntax(t);n=n.replace(t.value,r)}));var r=d(n);t.each(_,(function(n){var i=t.extend({},n,{value:d(n.value)}),a=e.templates.mentionItemSyntax(i),u=e.templates.mentionItemHighlight(i);r=r.replace(a,u)})),r=(r=r.replace(/\n/g,"<br />")).replace(/ {2}/g,"&nbsp; "),g.data("messageText",n),w.find("div").html(r)}function k(){E=[]}function S(n){var t=C();I=I||"";var r=new RegExp("\\"+e.triggerChar+I,"gi");r.exec(t);var i=r.lastIndex-I.length-1,a=r.lastIndex,u=t.substr(0,i),o=t.substr(a,t.length),l=(u+n.value).length+1;_.push(n),k(),I="",q();var c=u+n.value+" "+o;g.val(c),T(),g.focus(),v(g[0],l)}function C(){return n.trim(g.val())}function O(t){var e=n(this);return S(A[e.attr("data-uid")]),!1}function M(n){k()}function R(n){q()}e=n.extend(!0,{},p,e),t.debounce=function(n,t,e){var r;return function(){var i=this,a=arguments,u=function(){r=null,e||n.apply(i,a)},o=e&&!r;clearTimeout(r),r=setTimeout(u,t),o&&n.apply(i,a)}};var F=t.debounce((function(n){var r;T(),r=C(),_=t.reject(_,(function(n,t){return!n.value||-1==r.indexOf(n.value)})),_=t.compact(_);var i=t.lastIndexOf(E,e.triggerChar);i>-1&&(I=E.slice(i+1).join(""),I=m(I),t.defer(t.bind(z,this,I)))}),600);function N(t){E=n(this).val().split("")}function L(e){if(e.keyCode==u||e.keyCode==l||e.keyCode==f||e.keyCode==s)return t.defer(k),void(navigator.userAgent.indexOf("MSIE 9")>-1&&t.defer(T));if(e.keyCode!=r){if(!b.is(":visible"))return!0;switch(e.keyCode){case o:case c:var p=null;return(p=e.keyCode==c?j&&j.length?j.next():b.find("li").first():n(j).prev()).length&&B(p),!1;case a:case i:if(j&&j.length)return j.trigger("mousedown"),!1}return!0}E=E.slice(0,-1+E.length)}function q(){j=null,b.empty().hide()}function B(n){b.scrollTop(n[0].offsetTop),n.addClass(e.classes.autoCompleteItemActive),n.siblings().removeClass(e.classes.autoCompleteItemActive),j=n}function z(r){r&&r.length&&r.length>=e.minChars?e.onDataRequest.call(this,"search",r,(function(i){!function(r,i){b.show();var a=t.pluck(_,"value");if((i=t.reject(i,(function(n){return t.include(a,n.name)}))).length){b.empty();var u=n("<ul>").appendTo(b).hide();t.each(i,(function(i,a){var o=t.uniqueId("mention_");A[o]=t.extend({},i,{value:i.name});var l=n(e.templates.autocompleteListItem({id:d(i.id),display:d(i.name),type:d(i.type),content:h(d(i.name),r)})).attr("data-uid",o);0===a&&B(l),e.showAvatars&&(i.avatar?n(e.templates.autocompleteListItemAvatar({avatar:i.avatar})):n(e.templates.autocompleteListItemIcon({icon:i.icon}))).prependTo(l),l=l.appendTo(u)})),b.show(),u.show()}else q()}(r,i)})):q()}function D(){g.val(""),_=[],T()}return{init:function(t){"true"!=(g=n(t)).attr("data-mentions-input")&&(y=g.parent(),x=n(e.templates.wrapper()),g.wrapAll(x),x=y.find("> div"),g.attr("data-mentions-input","true"),g.bind("keydown",L),g.bind("input",N),g.bind("input",F),g.bind("click",M),g.bind("blur",R),e.elastic&&g.elastic()),(b=n(e.templates.autocompleteList())).appendTo(x),b.delegate("li","mousedown",O),(w=n(e.templates.mentionsOverlay())).prependTo(x),D(),e.prefillMention&&S(e.prefillMention)},val:function(n){if(t.isFunction(n)){var e=_.length?g.data("messageText"):C();n.call(this,e)}},reset:function(){D()},addMention:function(n){S(n)},getMentions:function(n){t.isFunction(n)&&n.call(this,_)}}};n.fn.mentionsInput=function(e,r){var i=arguments;return"object"!=typeof e&&e||(r=e),this.each((function(){var a=n.data(this,"mentionsInput")||n.data(this,"mentionsInput",new g(r));return t.isFunction(a[e])?a[e].apply(this,Array.prototype.slice.call(i,1)):"object"!=typeof e&&e?void n.error("Method "+e+" does not exist"):a.init.call(this,this)}))}}(jQuery,_);